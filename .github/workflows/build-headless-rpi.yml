name: Build Headless Native for Raspberry Pi

on:
  workflow_dispatch:

jobs:
  headless-native-arm64:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Set up dependencies
        run: |
          sudo apt-get update -qq
          sudo apt-get install -yqq build-essential cmake pkg-config git \
            liblo-dev qemu-user-static
      
      - name: Bootstrap PawPaw for ARM64 cross-compilation
        run: |
          ./deps/PawPaw/bootstrap-cardinal.sh linux-aarch64
          ./deps/PawPaw/.cleanup.sh linux-aarch64
      
      - name: Build headless native for ARM64
        run: |
          source deps/PawPaw/local.env linux-aarch64
          make HEADLESS=true native -j $(nproc)
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: CardinalNative-headless-linux-arm64
          path: bin/CardinalNative
